<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.housekeeping.housekeeping.mapper.ReservationMapper">

    <resultMap type="Reservation" id="ReservationResult">
        <result property="reservationId"    column="reservation_id"    />
        <result property="serveId"    column="serve_id"    />
        <result property="time"    column="time"    />
        <result property="address"    column="address"    />
        <result property="contacts"    column="contacts"    />
        <result property="phone"    column="phone"    />
        <result property="special"    column="special"    />
        <result property="status"    column="status"    />
        <result property="staffId"    column="staff_id"    />
        <result property="userId"    column="user_id"    />
        <result property="createTime"    column="create_time"    />
        <result property="userName"    column="user_name"    />
        <result property="serveName"    column="serveName"    />
        <result property="image"    column="image"    />
        <result property="category"    column="category"    />
        <result property="price"    column="price"    />
        <result property="staffName"    column="staffName"    />
    </resultMap>

    <sql id="selectReservationVo">
        select reservation_id, serve_id, time, address, contacts, phone, special, status, staff_id, user_id, create_time from reservation
    </sql>

    <select id="selectReservationList" parameterType="Reservation" resultMap="ReservationResult">
        select r.reservation_id, r.serve_id, r.time, r.address, r.contacts, r.phone, r.special, r.status,
               r.staff_id, r.user_id, r.create_time,
               u.user_name,
               s.name as serveName, s.image, s.category, s.price,
               staff.name as staffName
        from reservation r
        left join sys_user u on r.user_id = u.user_id
        left join serve s on r.serve_id = s.serve_id
        left join staff on r.staff_id = staff.staff_id
        <where>
            <if test="serveId != null  and serveId != ''"> and r.serve_id like concat('%', #{serveId}, '%')</if>
            <if test="params.beginTime != null and params.beginTime != '' and params.endTime != null and params.endTime != ''"> and r.time between #{params.beginTime} and #{params.endTime}</if>
            <if test="status != null  and status != ''"> and r.status = #{status}</if>
            <if test="staffId != null  and staffId != ''"> and r.staff_id like concat('%', #{staffId}, '%')</if>
            <if test="userId != null "> and r.user_id = #{userId}</if>
            <if test="userName != null "> and u.user_name = #{userName}</if>
            <if test="serveName != null  and serveName != ''"> and s.name like concat('%', #{serveName}, '%')</if>
            <if test="staffName != null  and staffName != ''"> and staff.name like concat('%', #{staffName}, '%')</if>
        </where>
        order by r.time desc
    </select>

    <select id="selectReservationByReservationId" parameterType="String" resultMap="ReservationResult">
        select r.reservation_id, r.serve_id, r.time, r.address, r.contacts, r.phone, r.special, r.status,
               r.staff_id, r.user_id, r.create_time,
               u.user_name,
               s.name as serveName, s.image, s.category, s.price
        from reservation r
                 left join sys_user u on r.user_id = u.user_id
                 left join serve s on r.serve_id = s.serve_id
        where reservation_id = #{reservationId}
    </select>

    <insert id="insertReservation" parameterType="Reservation">
        insert into reservation
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="reservationId != null">reservation_id,</if>
            <if test="serveId != null and serveId != ''">serve_id,</if>
            <if test="time != null">time,</if>
            <if test="address != null and address != ''">address,</if>
            <if test="contacts != null and contacts != ''">contacts,</if>
            <if test="phone != null and phone != ''">phone,</if>
            <if test="special != null and special != ''">special,</if>
            <if test="status != null and status != ''">status,</if>
            <if test="staffId != null">staff_id,</if>
            <if test="userId != null">user_id,</if>
            <if test="createTime != null">create_time,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="reservationId != null">#{reservationId},</if>
            <if test="serveId != null and serveId != ''">#{serveId},</if>
            <if test="time != null">#{time},</if>
            <if test="address != null and address != ''">#{address},</if>
            <if test="contacts != null and contacts != ''">#{contacts},</if>
            <if test="phone != null and phone != ''">#{phone},</if>
            <if test="special != null and special != ''">#{special},</if>
            <if test="status != null and status != ''">#{status},</if>
            <if test="staffId != null">#{staffId},</if>
            <if test="userId != null">#{userId},</if>
            <if test="createTime != null">#{createTime},</if>
         </trim>
    </insert>

    <update id="updateReservation" parameterType="Reservation">
        update reservation
        <trim prefix="SET" suffixOverrides=",">
            <if test="serveId != null and serveId != ''">serve_id = #{serveId},</if>
            <if test="time != null">time = #{time},</if>
            <if test="address != null and address != ''">address = #{address},</if>
            <if test="contacts != null and contacts != ''">contacts = #{contacts},</if>
            <if test="phone != null and phone != ''">phone = #{phone},</if>
            <if test="special != null and special != ''">special = #{special},</if>
            <if test="status != null and status != ''">status = #{status},</if>
            <if test="staffId != null">staff_id = #{staffId},</if>
            <if test="userId != null">user_id = #{userId},</if>
            <if test="createTime != null">create_time = #{createTime},</if>
        </trim>
        where reservation_id = #{reservationId}
    </update>

    <delete id="deleteReservationByReservationId" parameterType="String">
        delete from reservation where reservation_id = #{reservationId}
    </delete>

    <delete id="deleteReservationByReservationIds" parameterType="String">
        delete from reservation where reservation_id in
        <foreach item="reservationId" collection="array" open="(" separator="," close=")">
            #{reservationId}
        </foreach>
    </delete>
</mapper>

